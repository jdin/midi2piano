var xe=Object.defineProperty;var Yt=e=>{throw TypeError(e)};var Se=(e,n,t)=>n in e?xe(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t;var Jt=(e,n,t)=>Se(e,typeof n!="symbol"?n+"":n,t),Ct=(e,n,t)=>n.has(e)||Yt("Cannot "+t);var V=(e,n,t)=>(Ct(e,n,"read from private field"),t?t.call(e):n.get(e)),ht=(e,n,t)=>n.has(e)?Yt("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(e):n.set(e,t),At=(e,n,t,a)=>(Ct(e,n,"write to private field"),a?a.call(e,t):n.set(e,t),t),Qt=(e,n,t)=>(Ct(e,n,"access private method"),t);import{n as wt,a as $,t as xt}from"../chunks/BChazzFJ.js";import{a1 as Ce,b as Ae,M as It,h as I,a2 as Ie,J as De,m as p,T as Ge,K as Be,L as te,N as vt,g as ct,ag as Ne,O as fe,d as de,P as Le,ar as Dt,ak as ve,F as Ot,as as Oe,X as Re,A as ee,at as He,au as Ve,aj as Ue,av as We,f as je,aw as ze,ax as Ke,ae as $e,I as qe,a6 as ne,a7 as ae,a8 as Ze,ay as Xe,H as Ye,az as Je,aA as Qe,aB as tn,a as zt,an as en,am as nn,q as pe,ap as L,u as _t,s as Pe,C as S,w as N,v as U,x as Z,t as Rt,p as an,aC as se,aD as sn}from"../chunks/BNW1Pbhr.js";import{a as rn,l as on,s as ge,d as ln,e as un}from"../chunks/Dy9VwsK8.js";import{p as hn,a as G,i as ye}from"../chunks/C1EhBFoz.js";import{o as cn}from"../chunks/DnE6UDLs.js";import"../chunks/Bf5o6DaT.js";function fn(e,n){return n}function dn(e,n,t,a){for(var s=[],i=n.length,r=0;r<i;r++)Ve(n[r].e,s,!0);var u=i>0&&s.length===0&&t!==null;if(u){var c=t.parentNode;Ue(c),c.append(t),a.clear(),z(e,n[0].prev,n[i-1].next)}We(s,()=>{for(var h=0;h<i;h++){var l=n[h];u||(a.delete(l.k),z(e,l.prev,l.next)),je(l.e,!u)}})}function vn(e,n,t,a,s,i=null){var r=e,u={flags:n,items:new Map,first:null};{var c=e;r=I?It(Ie(c)):c.appendChild(Ce())}I&&De();var h=null,l=!1,g=Ge(()=>{var d=t();return qe(d)?d:d==null?[]:ve(d)});Ae(()=>{var d=p(g),P=d.length;if(l&&P===0)return;l=P===0;let v=!1;if(I){var k=r.data===Be;k!==(P===0)&&(r=te(),It(r),vt(!1),v=!0)}if(I){for(var _=null,f,m=0;m<P;m++){if(ct.nodeType===8&&ct.data===Ne){r=ct,v=!0,vt(!1);break}var C=d[m],F=a(C,m);f=be(ct,u,_,null,C,F,m,s,n,t),u.items.set(F,f),_=f}P>0&&It(te())}I||pn(d,u,r,s,n,a,t),i!==null&&(P===0?h?fe(h):h=de(()=>i(r)):h!==null&&Le(h,()=>{h=null})),v&&vt(!0),p(g)}),I&&(r=ct)}function pn(e,n,t,a,s,i,r){var u=e.length,c=n.items,h=n.first,l=h,g,d=null,P=[],v=[],k,_,f,m;for(m=0;m<u;m+=1){if(k=e[m],_=i(k,m),f=c.get(_),f===void 0){var C=l?l.e.nodes_start:t;d=be(C,n,d,d===null?n.first:d.next,k,_,m,a,s,r),c.set(_,d),P=[],v=[],l=d.next;continue}if(Pn(f,k,m),f.e.f&Dt&&fe(f.e),f!==l){if(g!==void 0&&g.has(f)){if(P.length<v.length){var F=v[0],w;d=F.prev;var O=P[0],q=P[P.length-1];for(w=0;w<P.length;w+=1)ie(P[w],F,t);for(w=0;w<v.length;w+=1)g.delete(v[w]);z(n,O.prev,q.next),z(n,d,O),z(n,q,F),l=F,d=q,m-=1,P=[],v=[]}else g.delete(f),ie(f,l,t),z(n,f.prev,f.next),z(n,f,d===null?n.first:d.next),z(n,d,f),d=f;continue}for(P=[],v=[];l!==null&&l.k!==_;)l.e.f&Dt||(g??(g=new Set)).add(l),v.push(l),l=l.next;if(l===null)continue;f=l}P.push(f),d=f,l=f.next}if(l!==null||g!==void 0){for(var D=g===void 0?[]:ve(g);l!==null;)l.e.f&Dt||D.push(l),l=l.next;var lt=D.length;if(lt>0){var R=u===0?t:null;dn(n,D,R,c)}}Ot.first=n.first&&n.first.e,Ot.last=d&&d.e}function Pn(e,n,t,a){Oe(e.v,n),e.i=t}function be(e,n,t,a,s,i,r,u,c,h){var l=(c&ze)!==0,g=(c&Ke)===0,d=l?g?Re(s):ee(s):s,P=c&He?ee(r):r,v={i:P,v:d,k:i,a:null,e:null,prev:t,next:a};try{return v.e=de(()=>u(e,d,P,h),I),v.e.prev=t&&t.e,v.e.next=a&&a.e,t===null?n.first=v:(t.next=v,t.e.next=v.e),a!==null&&(a.prev=v,a.e.prev=v.e),v}finally{}}function ie(e,n,t){for(var a=e.next?e.next.e.nodes_start:t,s=n?n.e.nodes_start:t,i=e.e.nodes_start;i!==a;){var r=$e(i);s.before(i),i=r}}function z(e,n,t){n===null?e.first=t:(n.next=t,n.e.next=t&&t.e),t!==null&&(t.prev=n,t.e.prev=n&&n.e)}function gn(e){if(I){var n=!1,t=()=>{if(!n){if(n=!0,e.hasAttribute("value")){var a=e.value;mt(e,"value",null),e.value=a}if(e.hasAttribute("checked")){var s=e.checked;mt(e,"checked",null),e.checked=s}}};e.__on_r=t,Qe(t),rn()}}function mt(e,n,t,a){var s=e.__attributes??(e.__attributes={});I&&(s[n]=e.getAttribute(n),n==="src"||n==="srcset"||n==="href"&&e.nodeName==="LINK")||s[n]!==(s[n]=t)&&(n==="style"&&"__styles"in e&&(e.__styles={}),n==="loading"&&(e[Xe]=t),t==null?e.removeAttribute(n):typeof t!="string"&&ke(e).includes(n)?e[n]=t:e.setAttribute(n,t))}function yn(e,n,t){var a=Ze,s=Ot;let i=I;I&&vt(!1),ne(null),ae(null);try{(Ht.has(e.nodeName)||!customElements||customElements.get(e.tagName.toLowerCase())?ke(e).includes(n):t&&typeof t=="object")?e[n]=t:mt(e,n,t==null?t:String(t))}finally{ne(a),ae(s),i&&vt(!0)}}var Ht=new Map;function ke(e){var n=Ht.get(e.nodeName);if(n)return n;Ht.set(e.nodeName,n=[]);for(var t,a=e,s=Element.prototype;s!==a;){t=Je(a);for(var i in t)t[i].set&&n.push(i);a=Ye(a)}return n}function re(e,n,t){if(t){if(e.classList.contains(n))return;e.classList.add(n)}else{if(!e.classList.contains(n))return;e.classList.remove(n)}}function Gt(e,n,t,a){var s=e.__styles??(e.__styles={});s[n]!==t&&(s[n]=t,t==null?e.style.removeProperty(n):e.style.setProperty(n,t,""))}function bn(e,n,t=n){var a=tn();on(e,"input",s=>{var i=s?e.defaultValue:e.value;if(i=Bt(e)?Nt(i):i,t(i),a&&i!==(i=n())){var r=e.selectionStart,u=e.selectionEnd;e.value=i??"",u!==null&&(e.selectionStart=r,e.selectionEnd=Math.min(u,e.value.length))}}),(I&&e.defaultValue!==e.value||zt(n)==null&&e.value)&&t(Bt(e)?Nt(e.value):e.value),en(()=>{var s=n();Bt(e)&&s===Nt(e.value)||e.type==="date"&&!s&&!e.value||s!==e.value&&(e.value=s??"")})}function Bt(e){var n=e.type;return n==="number"||n==="range"}function Nt(e){return e===""?null:+e}var K,ot,Pt,Ft,_e;const Et=class Et{constructor(n){ht(this,Ft);ht(this,K,new WeakMap);ht(this,ot);ht(this,Pt);At(this,Pt,n)}observe(n,t){var a=V(this,K).get(n)||new Set;return a.add(t),V(this,K).set(n,a),Qt(this,Ft,_e).call(this).observe(n,V(this,Pt)),()=>{var s=V(this,K).get(n);s.delete(t),s.size===0&&(V(this,K).delete(n),V(this,ot).unobserve(n))}}};K=new WeakMap,ot=new WeakMap,Pt=new WeakMap,Ft=new WeakSet,_e=function(){return V(this,ot)??At(this,ot,new ResizeObserver(n=>{for(var t of n){Et.entries.set(t.target,t);for(var a of V(this,K).get(t.target)||[])a(t)}}))},Jt(Et,"entries",new WeakMap);let Vt=Et;var kn=new Vt({box:"border-box"});function _n(e,n,t){var a=kn.observe(e,()=>t(e[n]));nn(()=>(zt(()=>t(e[n])),a))}var mn=wt('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 9-3 3m0 0 3 3m-3-3h7.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"></path></svg>');function Mn(e){var n=mn();$(e,n)}var Tn=wt('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6"><path stroke-linecap="round" stroke-linejoin="round" d="M14.25 9v6m-4.5 0V9M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"></path></svg>');function Fn(e){var n=Tn();$(e,n)}var En=wt('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6"><path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M15.91 11.672a.375.375 0 0 1 0 .656l-5.603 3.113a.375.375 0 0 1-.557-.328V8.887c0-.286.307-.466.557-.327l5.603 3.112Z"></path></svg>');function wn(e){var n=En();$(e,n)}var xn=wt('<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6"><path stroke-linecap="round" stroke-linejoin="round" d="m12.75 15 3-3m0 0-3-3m3 3h-7.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"></path></svg>');function Sn(e){var n=xn();$(e,n)}const Cn=[1,2,3,4,5,6,7],An=["C","D","E","F","G","A","B"],In=24,Ut=Cn.flatMap(e=>An.map(n=>`${n}${e}`));function*Dn(){for(const e of Ut){yield e;const n=e[0];n!=="E"&&n!=="B"&&(yield me(e))}}const Gn=[...Dn()];function Bn(e){return Gn[e-In]}function me(e){const n=e[0],t=e[1];return`${n}#${t}`}var Nn=xt('<span class="svelte-gws4cc"></span>'),Ln=xt('<li class="svelte-gws4cc"><!> </li>'),On=xt('<ul class="svelte-gws4cc"></ul>');function Rn(e,n){pe(n,!0);let t=hn(n,"midi",19,()=>[]),a=L(void 0),s=L(G([]));_t(()=>{if(typeof n.tick=="number"&&t().length){const c=t().map(Bn);n.tick==p(a)?S(s,G(zt(()=>c.reduce((h,l)=>h.includes(l)?h:[...h,l],p(s))))):(S(a,G(n.tick)),S(s,G([...c])))}});let i=L(void 0),r=L(5);_t(()=>{p(i)&&S(r,p(i)/Ut.length)});var u=On();vn(u,21,()=>Ut,fn,(c,h)=>{var l=Ln(),g=U(l);{var d=v=>{var k=Nn();const _=an(()=>p(r)/1.5);Rt(f=>{re(k,"selected",f),Gt(k,"width",`${p(_)??""}px`),Gt(k,"right",`-${p(_)/2+1}px`)},[()=>p(s).includes(me(p(h)))]),$(v,k)};ye(g,v=>{p(h)[0]!=="E"&&p(h)[0]!=="B"&&v(d)})}var P=Z(g);N(l),Rt(v=>{re(l,"selected",v),Gt(l,"width",`${p(r)??""}px`),ge(P,` ${p(h)??""}`)},[()=>p(s).includes(p(h))]),$(c,l)}),N(u),_n(u,"clientWidth",c=>S(i,c)),$(e,u),Pe()}function yt(e){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?yt=function(n){return typeof n}:yt=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},yt(e)}function Kt(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function oe(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function $t(e,n,t){return n&&oe(e.prototype,n),t&&oe(e,t),e}var B={NOTES:[],HEADER_CHUNK_LENGTH:14,CIRCLE_OF_FOURTHS:["C","F","Bb","Eb","Ab","Db","Gb","Cb","Fb","Bbb","Ebb","Abb"],CIRCLE_OF_FIFTHS:["C","G","D","A","E","B","F#","C#","G#","D#","A#","E#"]},Hn=[["C"],["C#","Db"],["D"],["D#","Eb"],["E"],["F"],["F#","Gb"],["G"],["G#","Ab"],["A"],["A#","Bb"],["B"]],le=0,Vn=function(n){Hn.forEach(function(t){t.forEach(function(a){return B.NOTES[le]=a+n}),le++})};for(var Lt=-1;Lt<=9;Lt++)Vn(Lt);var M=function(){function e(){Kt(this,e)}return $t(e,null,[{key:"byteToHex",value:function(t){return("0"+t.toString(16)).slice(-2)}},{key:"bytesToHex",value:function(t){var a=[];return t.forEach(function(s){return a.push(e.byteToHex(s))}),a.join("")}},{key:"hexToNumber",value:function(t){return parseInt(t,16)}},{key:"bytesToNumber",value:function(t){return e.hexToNumber(e.bytesToHex(t))}},{key:"bytesToLetters",value:function(t){var a=[];return t.forEach(function(s){return a.push(String.fromCharCode(s))}),a.join("")}},{key:"decToBinary",value:function(t){return(t>>>0).toString(2)}},{key:"getVarIntLength",value:function(t){for(var a=t[0],s=1;a>=128;)a=t[s],s++;return s}},{key:"readVarInt",value:function(t){var a=0;return t.forEach(function(s){var i=s;i&128?(a+=i&127,a<<=7):a+=i}),a}},{key:"atob",value:function(n){function t(a){return n.apply(this,arguments)}return t.toString=function(){return n.toString()},t}(function(n){return typeof atob=="function"?atob(n):Buffer.from(n,"base64").toString("binary")})}]),e}(),Un=function(){function e(n,t){Kt(this,e),this.enabled=!0,this.eventIndex=0,this.pointer=0,this.lastTick=0,this.lastStatus=null,this.index=n,this.data=t,this.delta=0,this.runningDelta=0,this.events=[];var a=this.data.subarray(this.data.length-3,this.data.length);if(!(a[0]===255&&a[1]===47&&a[2]===0))throw"Invalid MIDI file; Last three bytes of track "+this.index+"must be FF 2F 00 to mark end of track"}return $t(e,[{key:"reset",value:function(){return this.enabled=!0,this.eventIndex=0,this.pointer=0,this.lastTick=0,this.lastStatus=null,this.delta=0,this.runningDelta=0,this}},{key:"enable",value:function(){return this.enabled=!0,this}},{key:"disable",value:function(){return this.enabled=!1,this}},{key:"setEventIndexByTick",value:function(t){t=t||0;for(var a in this.events)if(this.events[a].tick>=t)return this.eventIndex=a,this}},{key:"getCurrentByte",value:function(){return this.data[this.pointer]}},{key:"getDeltaByteCount",value:function(){return M.getVarIntLength(this.data.subarray(this.pointer))}},{key:"getDelta",value:function(){return M.readVarInt(this.data.subarray(this.pointer,this.pointer+this.getDeltaByteCount()))}},{key:"handleEvent",value:function(t,a){if(a=a||!1,a){var s=t-this.lastTick,i=this.getDelta(),r=s>=i;if(this.pointer<this.data.length&&(a||r)){var u=this.parseEvent();if(this.enabled)return u}}else if(this.events[this.eventIndex]&&this.events[this.eventIndex].tick<=t&&(this.eventIndex++,this.enabled))return this.events[this.eventIndex-1];return null}},{key:"getStringData",value:function(t){var a=M.getVarIntLength(this.data.subarray(t+2)),s=M.readVarInt(this.data.subarray(t+2,t+2+a)),i=M.bytesToLetters(this.data.subarray(t+2+a,t+2+a+s));return i}},{key:"parseEvent",value:function(){var t=this.pointer+this.getDeltaByteCount(),a={},s=this.getDeltaByteCount();if(a.track=this.index+1,a.delta=this.getDelta(),this.lastTick=this.lastTick+a.delta,this.runningDelta+=a.delta,a.tick=this.runningDelta,a.byteIndex=this.pointer,this.data[t]==255){switch(this.data[t+1]){case 0:a.name="Sequence Number";break;case 1:a.name="Text Event",a.string=this.getStringData(t);break;case 2:a.name="Copyright Notice";break;case 3:a.name="Sequence/Track Name",a.string=this.getStringData(t);break;case 4:a.name="Instrument Name",a.string=this.getStringData(t);break;case 5:a.name="Lyric",a.string=this.getStringData(t);break;case 6:a.name="Marker";break;case 7:a.name="Cue Point",a.string=this.getStringData(t);break;case 9:a.name="Device Name",a.string=this.getStringData(t);break;case 32:a.name="MIDI Channel Prefix";break;case 33:a.name="MIDI Port",a.data=M.bytesToNumber([this.data[t+3]]);break;case 47:a.name="End of Track";break;case 81:a.name="Set Tempo",a.data=Math.round(6e7/M.bytesToNumber(this.data.subarray(t+3,t+6))),this.tempo=a.data;break;case 84:a.name="SMTPE Offset";break;case 88:a.name="Time Signature",a.data=this.data.subarray(t+3,t+7),a.timeSignature=""+a.data[0]+"/"+Math.pow(2,a.data[1]);break;case 89:a.name="Key Signature",a.data=this.data.subarray(t+3,t+5),a.data[0]>=0?a.keySignature=B.CIRCLE_OF_FIFTHS[a.data[0]]:a.data[0]<0&&(a.keySignature=B.CIRCLE_OF_FOURTHS[Math.abs(a.data[0])]),a.data[1]==0?a.keySignature+=" Major":a.data[1]==1&&(a.keySignature+=" Minor");break;case 127:a.name="Sequencer-Specific Meta-event";break;default:a.name="Unknown: "+this.data[t+1].toString(16);break}var i=M.getVarIntLength(this.data.subarray(t+2)),r=M.readVarInt(this.data.subarray(t+2,t+2+i));this.pointer+=s+3+r}else if(this.data[t]===240){a.name="Sysex";var u=M.getVarIntLength(this.data.subarray(t+1)),c=M.readVarInt(this.data.subarray(t+1,t+1+u));a.data=this.data.subarray(t+1+u,t+1+u+c),this.pointer+=s+1+u+c}else if(this.data[t]===247){a.name="Sysex (escape)";var h=M.getVarIntLength(this.data.subarray(t+1)),l=M.readVarInt(this.data.subarray(t+1,t+1+h));a.data=this.data.subarray(t+1+h,t+1+h+l),this.pointer+=s+1+h+l}else if(this.data[t]<128)if(a.running=!0,a.noteNumber=this.data[t],a.noteName=B.NOTES[this.data[t]],a.velocity=this.data[t+1],this.lastStatus<=143)a.name="Note off",a.channel=this.lastStatus-128+1,this.pointer+=s+2;else if(this.lastStatus<=159)a.name="Note on",a.channel=this.lastStatus-144+1,this.pointer+=s+2;else if(this.lastStatus<=175)a.name="Polyphonic Key Pressure",a.channel=this.lastStatus-160+1,a.note=B.NOTES[this.data[t+1]],a.pressure=event[1],this.pointer+=s+2;else if(this.lastStatus<=191)a.name="Controller Change",a.channel=this.lastStatus-176+1,a.number=this.data[t+1],a.value=this.data[t+2],this.pointer+=s+2;else if(this.lastStatus<=207)a.name="Program Change",a.channel=this.lastStatus-192+1,a.value=this.data[t+1],this.pointer+=s+1;else if(this.lastStatus<=223)a.name="Channel Key Pressure",a.channel=this.lastStatus-208+1,this.pointer+=s+1;else if(this.lastStatus<=239)a.name="Pitch Bend",a.channel=this.lastStatus-224+1,a.value=this.data[t+2],this.pointer+=s+2;else throw"Unknown event (running): ".concat(this.lastStatus);else if(this.lastStatus=this.data[t],this.data[t]<=143)a.name="Note off",a.channel=this.lastStatus-128+1,a.noteNumber=this.data[t+1],a.noteName=B.NOTES[this.data[t+1]],a.velocity=Math.round(this.data[t+2]/127*100),this.pointer+=s+3;else if(this.data[t]<=159)a.name="Note on",a.channel=this.lastStatus-144+1,a.noteNumber=this.data[t+1],a.noteName=B.NOTES[this.data[t+1]],a.velocity=Math.round(this.data[t+2]/127*100),this.pointer+=s+3;else if(this.data[t]<=175)a.name="Polyphonic Key Pressure",a.channel=this.lastStatus-160+1,a.note=B.NOTES[this.data[t+1]],a.pressure=event[2],this.pointer+=s+3;else if(this.data[t]<=191)a.name="Controller Change",a.channel=this.lastStatus-176+1,a.number=this.data[t+1],a.value=this.data[t+2],this.pointer+=s+3;else if(this.data[t]<=207)a.name="Program Change",a.channel=this.lastStatus-192+1,a.value=this.data[t+1],this.pointer+=s+2;else if(this.data[t]<=223)a.name="Channel Key Pressure",a.channel=this.lastStatus-208+1,this.pointer+=s+2;else if(this.data[t]<=239)a.name="Pitch Bend",a.channel=this.lastStatus-224+1,this.pointer+=s+3;else throw"Unknown event: ".concat(this.data[t]);return this.delta+=a.delta,this.events.push(a),a}},{key:"endOfTrack",value:function(){return this.data[this.pointer+1]==255&&this.data[this.pointer+2]==47&&this.data[this.pointer+3]==0}}]),e}();Uint8Array.prototype.forEach||Object.defineProperty(Uint8Array.prototype,"forEach",{value:Array.prototype.forEach});var Wn=function(){function e(n,t){Kt(this,e),this.sampleRate=5,this.startTime=0,this.buffer=t||null,this.midiChunksByteLength=null,this.division,this.format,this.setIntervalId=!1,this.tracks=[],this.instruments=[],this.defaultTempo=120,this.tempo=null,this.startTick=0,this.tick=0,this.lastTick=null,this.inLoop=!1,this.totalTicks=0,this.events=[],this.totalEvents=0,this.eventListeners={},typeof n=="function"&&this.on("midiEvent",n)}return $t(e,[{key:"loadFile",value:function(t){throw"loadFile is only supported on Node.js"}},{key:"loadArrayBuffer",value:function(t){return this.buffer=new Uint8Array(t),this.fileLoaded()}},{key:"loadDataUri",value:function(t){for(var a=M.atob(t.split(",")[1]),s=new Uint8Array(a.length),i=0;i<a.length;i++)s[i]=a.charCodeAt(i);return this.buffer=s,this.fileLoaded()}},{key:"getFilesize",value:function(){return this.buffer?this.buffer.length:0}},{key:"fileLoaded",value:function(){if(!this.validate())throw"Invalid MIDI file; should start with MThd";return this.setTempo(this.defaultTempo).getDivision().getFormat().getTracks().dryRun()}},{key:"validate",value:function(){return M.bytesToLetters(this.buffer.subarray(0,4))==="MThd"}},{key:"getFormat",value:function(){return this.format=M.bytesToNumber(this.buffer.subarray(8,10)),this}},{key:"getTracks",value:function(){this.tracks=[];for(var t=0;t<this.buffer.length;){if(M.bytesToLetters(this.buffer.subarray(t,t+4))=="MTrk"){var a=M.bytesToNumber(this.buffer.subarray(t+4,t+8));this.tracks.push(new Un(this.tracks.length,this.buffer.subarray(t+8,t+8+a)))}t+=M.bytesToNumber(this.buffer.subarray(t+4,t+8))+8}var s=0;return this.tracks.forEach(function(i){s+=8+i.data.length}),this.midiChunksByteLength=B.HEADER_CHUNK_LENGTH+s,this}},{key:"enableTrack",value:function(t){return this.tracks[t-1].enable(),this}},{key:"disableTrack",value:function(t){return this.tracks[t-1].disable(),this}},{key:"getDivision",value:function(){return this.division=M.bytesToNumber(this.buffer.subarray(12,B.HEADER_CHUNK_LENGTH)),this}},{key:"playLoop",value:function(t){this.inLoop||(this.inLoop=!0,this.tick=this.getCurrentTick(),this.tracks.forEach(function(a,s){if(!t&&this.endOfFile())this.triggerPlayerEvent("endOfFile"),this.stop();else{var i=a.handleEvent(this.tick,t);t&&i?(i.hasOwnProperty("name")&&i.name==="Set Tempo"&&(this.defaultTempo=i.data,this.setTempo(i.data)),i.hasOwnProperty("name")&&i.name==="Program Change"&&(this.instruments.includes(i.value)||this.instruments.push(i.value))):i&&(i.hasOwnProperty("name")&&i.name==="Set Tempo"&&(this.setTempo(i.data),this.isPlaying()&&this.pause().play()),this.emitEvent(i))}},this),t||this.triggerPlayerEvent("playing",{tick:this.tick}),this.inLoop=!1)}},{key:"setTempo",value:function(t){return this.tempo=t,this}},{key:"setStartTime",value:function(t){return this.startTime=t,this}},{key:"play",value:function(){if(this.isPlaying())throw"Already playing...";return this.startTime||(this.startTime=new Date().getTime()),this.setIntervalId=setInterval(this.playLoop.bind(this),this.sampleRate),this}},{key:"loop",value:function(){setTimeout((function(){this.playLoop(),this.loop()}).bind(this),this.sampleRate)}},{key:"pause",value:function(){return clearInterval(this.setIntervalId),this.setIntervalId=!1,this.startTick=this.tick,this.startTime=0,this}},{key:"stop",value:function(){return clearInterval(this.setIntervalId),this.setIntervalId=!1,this.startTick=0,this.startTime=0,this.resetTracks(),this}},{key:"skipToTick",value:function(t){return this.stop(),this.startTick=t,this.tracks.forEach(function(a){a.setEventIndexByTick(t)}),this}},{key:"skipToPercent",value:function(t){if(t<0||t>100)throw"Percent must be number between 1 and 100.";return this.skipToTick(Math.round(t/100*this.totalTicks)),this}},{key:"skipToSeconds",value:function(t){var a=this.getSongTime();if(t<0||t>a)throw t+" seconds not within song time of "+a;return this.skipToPercent(t/a*100),this}},{key:"isPlaying",value:function(){return this.setIntervalId>0||yt(this.setIntervalId)==="object"}},{key:"dryRun",value:function(){for(this.resetTracks();!this.endOfFile();)this.playLoop(!0);return this.events=this.getEvents(),this.totalEvents=this.getTotalEvents(),this.totalTicks=this.getTotalTicks(),this.startTick=0,this.startTime=0,this.resetTracks(),this.triggerPlayerEvent("fileLoaded",this),this}},{key:"resetTracks",value:function(){return this.tracks.forEach(function(t){return t.reset()}),this}},{key:"getEvents",value:function(){return this.tracks.map(function(t){return t.events})}},{key:"getTotalTicks",value:function(){return Math.max.apply(null,this.tracks.map(function(t){return t.delta}))}},{key:"getTotalEvents",value:function(){return this.tracks.reduce(function(t,a){return{events:{length:t.events.length+a.events.length}}},{events:{length:0}}).events.length}},{key:"getSongTime",value:function(){return this.totalTicks/this.division/this.tempo*60}},{key:"getSongTimeRemaining",value:function(){return Math.round((this.totalTicks-this.getCurrentTick())/this.division/this.tempo*60)}},{key:"getSongPercentRemaining",value:function(){return Math.round(this.getSongTimeRemaining()/this.getSongTime()*100)}},{key:"bytesProcessed",value:function(){return B.HEADER_CHUNK_LENGTH+this.tracks.length*8+this.tracks.reduce(function(t,a){return{pointer:t.pointer+a.pointer}},{pointer:0}).pointer}},{key:"eventsPlayed",value:function(){return this.tracks.reduce(function(t,a){return{eventIndex:t.eventIndex+a.eventIndex}},{eventIndex:0}).eventIndex}},{key:"endOfFile",value:function(){return this.isPlaying()?this.totalTicks-this.tick<=0:this.bytesProcessed()>=this.midiChunksByteLength}},{key:"getCurrentTick",value:function(){return this.startTime?Math.round((new Date().getTime()-this.startTime)/1e3*(this.division*(this.tempo/60)))+this.startTick:this.startTick}},{key:"emitEvent",value:function(t){return this.triggerPlayerEvent("midiEvent",t),this}},{key:"on",value:function(t,a){return this.eventListeners.hasOwnProperty(t)||(this.eventListeners[t]=[]),this.eventListeners[t].push(a),this}},{key:"triggerPlayerEvent",value:function(t,a){return this.eventListeners.hasOwnProperty(t)&&this.eventListeners[t].forEach(function(s){return s(a||{})}),this}}]),e}(),jn={Player:Wn},zn=Object.defineProperty,Kn=Object.defineProperties,$n=Object.getOwnPropertyDescriptors,ue=Object.getOwnPropertySymbols,qn=Object.prototype.hasOwnProperty,Zn=Object.prototype.propertyIsEnumerable,Me=e=>{throw TypeError(e)},he=(e,n,t)=>n in e?zn(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,rt=(e,n)=>{for(var t in n||(n={}))qn.call(n,t)&&he(e,t,n[t]);if(ue)for(var t of ue(n))Zn.call(n,t)&&he(e,t,n[t]);return e},pt=(e,n)=>Kn(e,$n(n)),qt=(e,n,t)=>n.has(e)||Me("Cannot "+t),o=(e,n,t)=>(qt(e,n,"read from private field"),t?t.call(e):n.get(e)),E=(e,n,t)=>n.has(e)?Me("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(e):n.set(e,t),T=(e,n,t,a)=>(qt(e,n,"write to private field"),n.set(e,t),t),Xn=(e,n,t)=>(qt(e,n,"access private method"),t),Mt=(e,n,t)=>new Promise((a,s)=>{var i=c=>{try{u(t.next(c))}catch(h){s(h)}},r=c=>{try{u(t.throw(c))}catch(h){s(h)}},u=c=>c.done?a(c.value):Promise.resolve(c.value).then(i,r);u((t=t.apply(e,n)).next())});function bt(e){const n=e.filter(t=>!!t);return n.reduce((t,a)=>{const s="output"in t?t.output:t,i="input"in a?a.input:a;return s.connect(i),a}),()=>{n.reduce((t,a)=>{const s="output"in t?t.output:t,i="input"in a?a.input:a;return s.disconnect(i),a})}}function Yn(e){let n=e;const t=new Set;function a(r){return t.add(r),r(n),()=>{t.delete(r)}}function s(r){n=r,t.forEach(u=>u(n))}function i(){return n}return{subscribe:a,set:s,get:i}}function Jn(){const e=new Set;function n(a){return e.add(a),()=>{e.delete(a)}}function t(a){e.forEach(s=>s(a))}return{subscribe:n,trigger:t}}function Qn(e){let n=!1;return()=>{n||(n=!0,e.forEach(t=>t==null?void 0:t()))}}function Te(e){return e*e/16129}var X,j,at,st,kt,Y,J,ta=class{constructor(e,n){this.context=e,E(this,X),E(this,j),E(this,at),E(this,st),E(this,kt),E(this,Y),E(this,J,!1);var t,a,s;T(this,Y,{destination:(t=n==null?void 0:n.destination)!=null?t:e.destination,volume:(a=n==null?void 0:n.volume)!=null?a:100,volumeToGain:(s=n==null?void 0:n.volumeToGain)!=null?s:Te}),this.input=e.createGain(),T(this,X,e.createGain()),T(this,st,bt([this.input,o(this,X),o(this,Y).destination]));const i=Yn(o(this,Y).volume);this.setVolume=i.set,T(this,kt,i.subscribe(r=>{o(this,X).gain.value=o(this,Y).volumeToGain(r)}))}addInsert(e){var n;if(o(this,J))throw Error("Can't add insert to disconnected channel");(n=o(this,at))!=null||T(this,at,[]),o(this,at).push(e),o(this,st).call(this),T(this,st,bt([this.input,...o(this,at),o(this,X),o(this,Y).destination]))}addEffect(e,n,t){var a;if(o(this,J))throw Error("Can't add effect to disconnected channel");const s=this.context.createGain();s.gain.value=t;const i="input"in n?n.input:n,r=bt([o(this,X),s,i]);(a=o(this,j))!=null||T(this,j,[]),o(this,j).push({name:e,mix:s,disconnect:r})}sendEffect(e,n){var t;if(o(this,J))throw Error("Can't send effect to disconnected channel");const a=(t=o(this,j))==null?void 0:t.find(s=>s.name===e);a?a.mix.gain.value=n:console.warn("Send bus not found: "+e)}disconnect(){var e;o(this,J)||(T(this,J,!0),o(this,st).call(this),o(this,kt).call(this),(e=o(this,j))==null||e.forEach(n=>n.disconnect()),T(this,j,void 0))}};X=new WeakMap;j=new WeakMap;at=new WeakMap;st=new WeakMap;kt=new WeakMap;Y=new WeakMap;J=new WeakMap;var x,ea=class{constructor(e){this.compare=e,E(this,x,[])}push(e){const n=o(this,x).length;let t=0,a=n-1,s=n;for(;t<=a;){const i=Math.floor((t+a)/2);this.compare(e,o(this,x)[i])<0?(s=i,a=i-1):t=i+1}o(this,x).splice(s,0,e)}pop(){return o(this,x).shift()}peek(){return o(this,x)[0]}removeAll(e){const n=o(this,x).length;return T(this,x,o(this,x).filter(t=>!e(t))),o(this,x).length!==n}clear(){T(this,x,[])}size(){return o(this,x).length}};x=new WeakMap;function ce(e,n){return e&&n?t=>{e(t),n(t)}:e??n}function na(e){var n,t,a;const s={disableScheduler:(n=e.disableScheduler)!=null?n:!1,scheduleLookaheadMs:(t=e.scheduleLookaheadMs)!=null?t:200,scheduleIntervalMs:(a=e.scheduleIntervalMs)!=null?a:50,onStart:e.onStart,onEnded:e.onEnded};if(s.scheduleLookaheadMs<1)throw Error("scheduleLookaheadMs must be greater than 0");if(s.scheduleIntervalMs<1)throw Error("scheduleIntervalMs must be greater than 0");if(s.scheduleLookaheadMs<s.scheduleIntervalMs)throw Error("scheduleLookaheadMs must be greater than scheduleIntervalMs");return s}var W,A,Q,aa=class{constructor(e,n={}){E(this,W),E(this,A),E(this,Q),T(this,W,na(n)),T(this,A,new ea((t,a)=>t.time-a.time)),this.player=e}get context(){return this.player.context}get buffers(){return this.player.buffers}get isRunning(){return o(this,Q)!==void 0}start(e){var n;if(o(this,W).disableScheduler)return this.player.start(e);const t=this.player.context,a=t.currentTime,s=(n=e.time)!=null?n:a,i=o(this,W).scheduleLookaheadMs/1e3;return e.onStart=ce(e.onStart,o(this,W).onStart),e.onEnded=ce(e.onEnded,o(this,W).onEnded),s<a+i?this.player.start(e):(o(this,A).push(pt(rt({},e),{time:s})),o(this,Q)||T(this,Q,setInterval(()=>{const r=t.currentTime+i;for(;o(this,A).size()&&o(this,A).peek().time<=r;){const u=o(this,A).pop();u&&this.player.start(u)}o(this,A).size()||(clearInterval(o(this,Q)),T(this,Q,void 0))},o(this,W).scheduleIntervalMs)),r=>{!r||r<s?o(this,A).removeAll(u=>u===e)||this.player.stop(pt(rt({},e),{time:r})):this.player.stop(pt(rt({},e),{time:r}))})}stop(e){var n;if(o(this,W).disableScheduler)return this.player.stop(e);if(this.player.stop(e),!e){o(this,A).clear();return}const t=(n=e==null?void 0:e.time)!=null?n:0,a=e==null?void 0:e.stopId;a?o(this,A).removeAll(s=>s.time>=t&&s.stopId?s.stopId===a:s.note===a):o(this,A).removeAll(s=>s.time>=t)}disconnect(){this.player.disconnect()}};W=new WeakMap;A=new WeakMap;Q=new WeakMap;var ft,it,dt,sa=class{constructor(e,n){this.context=e,this.options=n,E(this,ft),E(this,it,!1),E(this,dt);var t,a;T(this,ft,{velocityToGain:(t=n.velocityToGain)!=null?t:Te,destination:(a=n.destination)!=null?a:e.destination}),this.buffers={},T(this,dt,Jn())}start(e){var n,t,a,s,i,r,u,c,h,l,g,d,P,v;if(o(this,it))throw new Error("Can't start a sample on disconnected player");const k=this.context,_=e.name&&this.buffers[e.name]||this.buffers[e.note];if(!_)return console.warn(`Sample not found: '${e.note}'`),()=>{};const f=k.createBufferSource();f.buffer=_;const m=(t=(n=e.detune)!=null?n:this.options.detune)!=null?t:0;f.detune?f.detune.value=m:f.playbackRate&&(f.playbackRate.value=Math.pow(2,m/1200));const C=(a=e.lpfCutoffHz)!=null?a:this.options.lpfCutoffHz,F=C?k.createBiquadFilter():void 0;C&&F&&(F.type="lowpass",F.frequency.value=C);const w=k.createGain(),O=(i=(s=e.velocity)!=null?s:this.options.velocity)!=null?i:100;w.gain.value=o(this,ft).velocityToGain(O),((r=e.loop)!=null?r:this.options.loop)&&(f.loop=!0,f.loopStart=(u=e.loopStart)!=null?u:0,f.loopEnd=(c=e.loopEnd)!=null?c:_.duration);const D=(h=e.decayTime)!=null?h:this.options.decayTime,[lt,R]=ia(k,D);function tt(b){if(b??(b=k.currentTime),b<=gt)f.stop(b);else{const H=R(b);f.stop(H)}}const ut=e.gainOffset?k.createGain():void 0;ut&&e.gainOffset&&(ut.gain.value=e.gainOffset);const St=(l=e.stopId)!=null?l:e.note,et=Qn([bt([f,F,w,lt,ut,o(this,ft).destination]),(g=e.stop)==null?void 0:g.call(e,tt),o(this,dt).subscribe(b=>{(!b||b.stopId===void 0||b.stopId===St)&&tt(b==null?void 0:b.time)})]);f.onended=()=>{var b;et(),(b=e.onEnded)==null||b.call(e,e)},(d=e.onStart)==null||d.call(e,e);const gt=Math.max((P=e.time)!=null?P:0,k.currentTime);f.start(e.time);let y=(v=e.duration)!=null?v:_.duration;return typeof e.duration=="number"&&tt(gt+y),tt}stop(e){o(this,dt).trigger(e)}disconnect(){o(this,it)||(T(this,it,!0),this.stop(),Object.keys(this.buffers).forEach(e=>{delete this.buffers[e]}))}get connected(){return!o(this,it)}};ft=new WeakMap;it=new WeakMap;dt=new WeakMap;function ia(e,n=.2){let t=0;const a=e.createGain();a.gain.value=1;function s(i){if(t)return t;a.gain.cancelScheduledValues(i);const r=i||e.currentTime;return t=r+n,a.gain.setValueAtTime(1,r),a.gain.linearRampToValueAtTime(0,t),t}return[a,s]}var ra=class{constructor(e,n){this.context=e;const t=new ta(e,n);this.player=new aa(new sa(e,pt(rt({},n),{destination:t.input})),n),this.output=t}get buffers(){return this.player.buffers}start(e){return this.player.start(e)}stop(e){this.player.stop(typeof e=="object"?e:e!==void 0?{stopId:e}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}};function oa(e,n,t){return Mt(this,null,function*(){n=n.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");const a=yield t.fetch(n);if(a.status!==200){console.warn("Error loading buffer. Invalid status: ",a.status,n);return}try{const s=yield a.arrayBuffer();return yield e.decodeAudioData(s)}catch(s){console.warn("Error loading buffer",s,n)}})}function la(e){if(typeof document>"u")return null;const n=document.createElement("audio");for(let t=0;t<e.length;t++){const a=e[t],s=n.canPlayType(`audio/${a}`);if(s==="probably"||s==="maybe")return a;if(a==="m4a"){const i=n.canPlayType("audio/aac");if(i==="probably"||i==="maybe")return a}}return null}var ua={fetch(e){return fetch(e)}};function ha(e){const t=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(e);if(!t)return;const a=t[1].toUpperCase();if(!a)return;const s=t[2],i=s[0]==="b"?-s.length:s.length,r=t[3]?+t[3]:4,u=(a.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][u]+i+12*(r+1)}function Wt(e){return e===void 0?void 0:typeof e=="number"?e:ha(e)}var ca="https://danigb.github.io/samples/splendid-grand-piano",jt,Fe,fa=class{constructor(e,n){this.context=e,E(this,jt),this.options=Object.assign({baseUrl:ca,storage:ua,detune:0,volume:100,velocity:100,decayTime:.5},n),this.player=new ra(e,this.options);const t=va(this.options.baseUrl,this.options.storage,this.options.notesToLoad);this.load=t(e,this.player.buffers).then(()=>this)}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return Mt(this,null,function*(){return console.warn("deprecated: use load instead"),this.load})}start(e){var n,t;const a=typeof e=="object"?rt({},e):{note:e},s=Xn(this,jt,Fe).call(this,a);return s?(a.note=s[0],a.stopId=(n=a.stopId)!=null?n:s[1],a.detune=s[2]+((t=a.detune)!=null?t:this.options.detune),this.player.start(a)):()=>{}}stop(e){var n;if(typeof e=="string")return this.player.stop((n=Wt(e))!=null?n:e);if(typeof e=="object"){const t=Wt(e.stopId);return this.player.stop(t!==void 0?pt(rt({},e),{stopId:t}):e)}else return this.player.stop(e)}};jt=new WeakSet;Fe=function(e){var n;const t=Wt(e.note);if(!t)return;const a=(n=e.velocity)!=null?n:this.options.velocity,s=Tt.findIndex(r=>a>=r.vel_range[0]&&a<=r.vel_range[1]),i=Tt[s];if(i)return da(i.name,t,this.player.buffers)};function da(e,n,t){let a=0;for(;t[e+(n+a)]===void 0&&a<128;)a>0?a=-a:a=-a+1;return a===127?[e+n,n,0]:[e+(n+a),n,-a*100]}function va(e,n,t){var a;const s=(a=la(["ogg","m4a"]))!=null?a:"ogg";let i=t?Tt.filter(r=>r.vel_range[0]<=t.velocityRange[1]&&r.vel_range[1]>=t.velocityRange[0]):Tt;return(r,u)=>Mt(this,null,function*(){for(const c of i){const h=t?c.samples.filter(l=>t.notes.includes(l[0])):c.samples;yield Promise.all(h.map(l=>Mt(this,[l],function*([g,d]){const P=`${e}/${d}.${s}`,v=yield oa(r,P,n);v&&(u[c.name+g]=v)})))}})}var Tt=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}],pa=xt('<section class="svelte-j2ebei"><title-header><input type="file" accept=".mid"></title-header> <!> <info class="svelte-j2ebei"><span> </span></info> <input id="default-range" type="range" class="h-2 w-full cursor-pointer appearance-none rounded-lg bg-gray-200 dark:bg-gray-700"> <toolbar class="svelte-j2ebei"><button class="svelte-j2ebei"><!></button> <button class="svelte-j2ebei"><!></button> <button class="svelte-j2ebei"><!></button></toolbar></section>',2);function Ma(e,n){pe(n,!0);let t=L(0),a=L(0),s=L(!1),i=L(G({})),r;cn(async()=>{const y=new AudioContext,b=new fa(y);r=new jn.Player(H=>{H.name=="Note on"&&(S(t,G(Object.keys(p(i)).indexOf(String(H.tick)))),b.start({note:H.noteName,velocity:H.velocity}))})});const u=async y=>{var H;const b=(H=y.currentTarget.files)==null?void 0:H[0];if(b){r==null||r.stop();const Ee=await b.arrayBuffer();r==null||r.loadArrayBuffer(Ee),S(a,G(r==null?void 0:r.totalTicks)),S(i,G(r==null?void 0:r.getEvents().flatMap(nt=>nt).filter(nt=>nt.name==="Note on").reduce((nt,Zt)=>{const Xt=Zt.tick,we=nt[Xt]||[];return{...nt,[Xt]:[...we,Zt]}},{})))}};function c(){p(s)?(S(s,!1),r==null||r.stop()):(S(s,!0),r==null||r.skipToTick(h(p(t))),r==null||r.play())}function h(y){return parseInt(Object.keys(p(i))[y])}function l(){p(t)>0&&se(t,-1)}function g(){p(t)<Object.keys(p(i)).length-1&&se(t)}let d=L(G([])),P=L(0);_t(()=>{S(P,G(h(p(t))))}),_t(()=>{const y=p(i)[p(P)];S(d,G(y==null?void 0:y.map(b=>b.noteNumber)))});function v(y){switch(y.key){case" ":c();break;case"ArrowLeft":l();break;case"ArrowRight":g();break}}var k=pa();un("keydown",sn,v);var _=U(k);yn(_,"class","flex gap-8");var f=U(_);f.__change=u,N(_);var m=Z(_,2);Rn(m,{get midi(){return p(d)},get tick(){return p(P)}});var C=Z(m,2),F=U(C),w=U(F,!0);N(F),N(C);var O=Z(C,2);gn(O);var q=Z(O,2),D=U(q);D.__click=l;var lt=U(D);Mn(lt),N(D);var R=Z(D,2);R.__click=c;var tt=U(R);{var ut=y=>{Fn(y)},St=y=>{wn(y)};ye(tt,y=>{p(s)?y(ut):y(St,!1)})}N(R);var et=Z(R,2);et.__click=g;var gt=U(et);Sn(gt),N(et),N(q),N(k),Rt((y,b)=>{ge(w,y),mt(O,"max",b),D.disabled=p(a)===0,R.disabled=p(a)===0,et.disabled=p(a)===0},[()=>h(p(t))||"0",()=>Object.keys(p(i)).length]),bn(O,()=>p(t),y=>S(t,y)),$(e,k),Pe()}ln(["change","click"]);export{Ma as component};
